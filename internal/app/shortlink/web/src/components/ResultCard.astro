---
// ResultCard component - displays generated short link with QR code
---

<section id="result-card" class="hidden animate-slide-up mt-8">
  <div class="card p-6 sm:p-8 border-primary-100 dark:border-primary-900/30 bg-white/50 dark:bg-slate-900/50 backdrop-blur-xl">
    <div class="flex items-center gap-3 mb-6">
      <div class="flex items-center justify-center w-8 h-8 rounded-full bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400">
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      </div>
      <h3 class="text-lg font-bold text-gray-900 dark:text-white">您的短链接已就绪</h3>
    </div>

    <!-- Short URL display -->
    <div class="relative group mb-6">
      <div class="absolute -inset-1 bg-gradient-to-r from-primary-600 to-indigo-600 rounded-2xl blur opacity-10 group-hover:opacity-20 transition duration-1000"></div>
      <div class="relative flex items-center gap-3 p-4 bg-white dark:bg-slate-800 rounded-xl border border-gray-100 dark:border-white/5">
        <div class="flex-1 min-w-0">
          <p class="text-[10px] font-bold text-gray-400 dark:text-slate-500 uppercase tracking-widest mb-1">生成的短链接</p>
          <a
            id="short-url-link"
            href="#"
            target="_blank"
            rel="noopener noreferrer"
            class="block text-lg font-bold text-primary-600 dark:text-primary-400 hover:text-primary-500 truncate transition-colors"
          >
            <span id="short-url-text"></span>
          </a>
        </div>
        <button
          id="copy-btn"
          type="button"
          class="flex items-center gap-2 px-4 py-2 bg-primary-50 dark:bg-primary-900/20 text-primary-600 dark:text-primary-400 font-bold text-sm rounded-lg hover:bg-primary-100 dark:hover:bg-primary-900/40 transition-all active:scale-95"
        >
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
          </svg>
          复制
        </button>
      </div>
    </div>

    <!-- Original URL & QR Section -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pt-6 border-t border-gray-100 dark:border-white/5">
      <div class="space-y-4">
        <div>
          <p class="text-[10px] font-bold text-gray-400 dark:text-slate-500 uppercase tracking-widest mb-1.5">原始链接</p>
          <p id="original-url" class="text-sm text-gray-600 dark:text-slate-400 break-all line-clamp-2 font-medium"></p>
        </div>
        <button
          id="download-qr-btn"
          type="button"
          class="btn-secondary w-full sm:w-auto text-sm flex items-center justify-center gap-2"
        >
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          保存二维码
        </button>
      </div>

      <div class="flex flex-col items-center justify-center p-4 bg-gray-50 dark:bg-slate-900/50 rounded-2xl border border-gray-100 dark:border-white/5">
        <div class="bg-white p-2 rounded-lg shadow-sm">
          <canvas id="qrcode-canvas" width="140" height="140"></canvas>
        </div>
        <p class="mt-3 text-[10px] text-gray-400 dark:text-slate-500 font-medium">扫一扫快速访问</p>
      </div>
    </div>
  </div>
</section>

<script>
  // Copy to clipboard
  const copyBtn = document.getElementById('copy-btn');
  const shortUrlText = document.getElementById('short-url-text');

  copyBtn?.addEventListener('click', async () => {
    const url = shortUrlText?.textContent || '';
    if (!url) return;

    try {
      if (navigator.clipboard && window.isSecureContext) {
        await navigator.clipboard.writeText(url);
      } else {
        // Fallback
        const ta = document.createElement('textarea');
        ta.value = url;
        ta.style.position = 'fixed';
        ta.style.left = '-9999px';
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
      }

      // Show feedback
      const originalText = copyBtn.textContent;
      copyBtn.textContent = '已复制 ✓';
      setTimeout(() => {
        copyBtn.textContent = originalText;
      }, 1500);
    } catch {
      alert('复制失败，请手动复制：' + url);
    }
  });

  // Download QR code
  const downloadBtn = document.getElementById('download-qr-btn');
  const qrCanvas = document.getElementById('qrcode-canvas') as HTMLCanvasElement;

  downloadBtn?.addEventListener('click', () => {
    if (!qrCanvas) return;

    const link = document.createElement('a');
    link.download = 'qrcode.png';
    link.href = qrCanvas.toDataURL('image/png');
    link.click();
  });
</script>
