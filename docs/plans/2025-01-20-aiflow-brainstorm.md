# AIFlow 项目头脑风暴记录

日期：2025-01-20

## 项目背景

AIFlow 是一个基于 Go 的 AI 平台，已有功能包括：
- LLM 集成（DeepSeek）
- 知识库 RAG
- Agent 工作流
- Web API + 桌面应用

## 项目定位讨论

### 初始困惑

项目开始时的动机：
1. 学习和实践 Go + AI 技术栈
2. 让 AI 帮助自己（写 blog）和朋友（写简历、聊个人问题）
3. 开源展示

困惑点：这些需求 ChatGPT/Claude 都能做，项目的独特价值在哪里？

### 发现的痛点

通过讨论，发现了现有 AI 工具的三个不足：

1. **记忆弱**：ChatGPT 记忆有限，Claude 几乎没有跨会话记忆，每次都要重新解释背景
2. **无后台任务**：都是"你问我答"模式，关掉就停了
3. **无多模型协同**：要自己开多个窗口，手动当"中间人"

### 最终定位

> 一个"记得你是谁"、能在后台持续工作、能调度多个 AI 协作的个人助手

## 分阶段规划

### Phase 1: 记忆系统（优先）

**为什么优先**：
- 是差异化的核心
- 技术可控
- 后续功能都依赖它

**设计思路**：采用三层分层记忆，而非纯 RAG

### Phase 2: 后台任务（第二）

**最初的担忧**：
- 用户不会每天看电脑
- LLM 怎么通知用户？
- "提醒我周日看牙" 这种任务手机日历更好

**重新定义**：
AI 后台任务的价值不在于"提醒"，而在于"智能处理"：
- 每周总结行业新闻
- 每天检查竞品网站更新
- 每周五生成周报草稿
- Blog 内容生成
- 简历制作

这些任务需要 AI 智能，结果可以异步消费（邮件推送或等用户来取）。

### Phase 3: 多模型协同（第三）

技术最复杂，在前两个到位后才能发挥最大威力。

## 记忆系统设计决策

### 为什么不用纯 RAG？

纯 RAG 的问题：
- 语义分块不够准确
- 缺乏全局性（只检索片段）
- 重排序不准
- 无法更新/遗忘

### 备选方案对比

1. **结构化记忆**：提取 key-value 事实
   - 问题：把人"切碎"成标签，丢失关联和语境

2. **分层记忆**：原始对话 → 摘要 → 核心画像
   - 优点：平衡细节和全局，像人类记忆
   - 选择了这个方案

3. **图结构**：知识图谱
   - 问题：构建和维护复杂

4. **记忆流**：所有记忆按 recency × relevance × importance 排序
   - 问题：评分机制难调

### 关于结构化 vs 自然语言画像

最初设计用 JSON 结构存画像，后改为自然语言段落。

原因：
```json
// 结构化（丢失关联）
{"occupation": "程序员", "traits": ["焦虑"]}

// 自然语言（保留因果）
"小明是程序员，最近压力大想换工作，但担心收入——反映了他谨慎的性格"
```

自然语言更像"认识一个人"而不是"看一份档案"。

### RAG 在记忆系统中的位置

RAG 是检索手段，不是记忆结构。

- Layer 3（核心画像）：直接携带，不需要 RAG
- Layer 2（会话摘要）：最近 N 条直接携带，历史的用 RAG 检索
- Layer 1（原始对话）：按需 RAG 检索细节

复用现有 RAG 模块的 Embedding + VectorStore，不需要分块逻辑。

## 交付形态

### 主要形态：Docker 自部署

- 用户在自己的 VPS / NAS / 家庭服务器部署
- 24/7 运行，支持定时任务
- 数据完全自己掌控
- 通过 Web UI 访问

### 辅助形态：桌面应用

- 给不想折腾服务器的朋友
- 简化版功能（对话 + 记忆）
- 电脑开着时可用

### 为什么不做纯 SaaS？

- 需要承担服务器成本
- 用户数据隐私问题
- 作为开源项目，自部署更合理

## 后续行动

1. 先实现 Phase 1（记忆系统）
2. 实现过程中积累经验
3. Phase 1 完成后再设计 Phase 2

## 相关文档

- [记忆系统设计文档](./2025-01-20-memory-system-design.md)
