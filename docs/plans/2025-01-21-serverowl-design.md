# ServerOwl è®¾è®¡æ–‡æ¡£

æ—¥æœŸï¼š2025-01-21
çŠ¶æ€ï¼šå¾…å®ç°

## é¡¹ç›®æ¦‚è§ˆ

### é¡¹ç›®åç§°

**ServerOwl**ï¼ˆæœåŠ¡å™¨çŒ«å¤´é¹°ï¼‰â€” ä¸€ä¸ª AI é©±åŠ¨çš„ä¸ªäººæœåŠ¡å™¨è¿ç»´åŠ©æ‰‹

### é¡¹ç›®å®šä½

ä¸ºç‹¬ç«‹å¼€å‘è€…æ‰“é€ çš„è½»é‡çº§æœåŠ¡å™¨ç›‘æ§å’Œè¿ç»´å·¥å…·ã€‚é€šè¿‡ä¼ä¸šå¾®ä¿¡ä¸æœåŠ¡å™¨å¯¹è¯ï¼Œéšæ—¶æŒæ¡æœåŠ¡çŠ¶æ€ï¼Œå¿«é€Ÿå¤„ç†é—®é¢˜ã€‚

### æ ¸å¿ƒä»·å€¼

| ç—›ç‚¹ | è§£å†³æ–¹æ¡ˆ |
|------|---------|
| ä¸çŸ¥é“æœåŠ¡æŒ‚æ²¡æŒ‚ | å®šæ—¶ç›‘æ§ + ä¸»åŠ¨å‘Šè­¦ |
| æ’æŸ¥é—®é¢˜è¦ç¿»æ—¥å¿— | AI åˆ†ææ—¥å¿—ï¼Œç›´æ¥å‘Šè¯‰ä½ åŸå›  |
| è¿ç»´æ“ä½œè¦ SSH | å¾®ä¿¡å‘æ¶ˆæ¯å°±èƒ½æ“ä½œ |

### MVP åŠŸèƒ½

1. **ç›‘æ§å‘Šè­¦**ï¼šæ¯ 15 åˆ†é’Ÿæ£€æŸ¥å®¹å™¨ã€HTTPã€æ•°æ®åº“ã€ç£ç›˜ã€å†…å­˜
2. **å¾®ä¿¡é€šçŸ¥**ï¼šå¼‚å¸¸æ—¶æ¨é€åˆ°ä¼ä¸šå¾®ä¿¡
3. **å¯¹è¯æ“ä½œ**ï¼šé€šè¿‡å¾®ä¿¡å‘æŒ‡ä»¤ï¼ˆçŠ¶æ€ã€é‡å¯ã€æ—¥å¿—ï¼‰
4. **æ—¥å¿—åˆ†æ**ï¼šAI åˆ†æé”™è¯¯æ—¥å¿—ï¼Œç»™å‡ºå»ºè®®

### è®¾è®¡åŸåˆ™

- **ç®€å•ä¼˜å…ˆ**ï¼šå•äºŒè¿›åˆ¶éƒ¨ç½²ï¼Œæ— å¤æ‚ä¾èµ–
- **å¯æ‰©å±•**ï¼šæ¶æ„é¢„ç•™å¤šæœåŠ¡å™¨æ”¯æŒ
- **å®‰å…¨**ï¼šæ•æ„Ÿæ“ä½œéœ€ç¡®è®¤ï¼Œé™åˆ¶å¯æ‰§è¡Œå‘½ä»¤

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä½ çš„æœåŠ¡å™¨                            â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   ServerOwl                          â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ ç›‘æ§æ¨¡å—  â”‚  â”‚ é€šçŸ¥æ¨¡å—  â”‚  â”‚  æŒ‡ä»¤å¤„ç†æ¨¡å—    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ Monitor  â”‚  â”‚ Notifier â”‚  â”‚  Commander       â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚       â”‚             â”‚                  â”‚            â”‚   â”‚
â”‚  â”‚       â–¼             â”‚                  â–¼            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚              Core (è°ƒåº¦ä¸­å¿ƒ)                  â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                     â”‚                              â”‚   â”‚
â”‚  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚  â”‚       â–¼             â–¼             â–¼               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚
â”‚  â”‚  â”‚ Docker  â”‚  â”‚  System  â”‚  â”‚   LLM    â”‚         â”‚   â”‚
â”‚  â”‚  â”‚ Client  â”‚  â”‚  Metrics â”‚  â”‚  Client  â”‚         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚ çŸ­é“¾æ¥æœåŠ¡   â”‚  â† è¢«ç›‘æ§çš„æœåŠ¡                            â”‚
â”‚  â”‚ (Docker)    â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ä¼ä¸šå¾®ä¿¡                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚  ä½ çš„æ‰‹æœºå¾®ä¿¡                   â”‚    â”‚
â”‚   â”‚  - æ”¶å‘Šè­¦                      â”‚    â”‚
â”‚   â”‚  - å‘æŒ‡ä»¤                      â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—èŒè´£

| æ¨¡å— | èŒè´£ |
|------|------|
| **Core** | è°ƒåº¦ä¸­å¿ƒï¼Œåè°ƒå„æ¨¡å— |
| **Monitor** | å®šæ—¶æ£€æŸ¥ï¼Œå‘ç°å¼‚å¸¸ |
| **Notifier** | å‘é€å¾®ä¿¡é€šçŸ¥ |
| **Commander** | è§£ææŒ‡ä»¤ï¼Œæ‰§è¡Œæ“ä½œ |
| **Docker Client** | å®¹å™¨æ“ä½œå°è£… |
| **System Metrics** | ç³»ç»ŸæŒ‡æ ‡é‡‡é›† |
| **LLM Client** | AI èƒ½åŠ›å°è£… |

### æŠ€æœ¯æ ˆ

| å±‚é¢ | æŠ€æœ¯ | ç”¨é€” |
|------|------|------|
| **è¯­è¨€** | Go | ä¸»è¯­è¨€ |
| **å®šæ—¶ä»»åŠ¡** | Go å†…ç½® ticker / cron åº“ | æ¯ 15 åˆ†é’Ÿæ£€æŸ¥ |
| **Docker æ“ä½œ** | Docker SDK for Go | æ£€æŸ¥å®¹å™¨çŠ¶æ€ã€é‡å¯å®¹å™¨ |
| **ç³»ç»ŸæŒ‡æ ‡** | gopsutil | è·å– CPUã€å†…å­˜ã€ç£ç›˜ |
| **HTTP æ£€æŸ¥** | Go net/http | æ£€æµ‹æœåŠ¡æ˜¯å¦å¯è¾¾ |
| **LLM** | DeepSeek / OpenAI API | æ—¥å¿—åˆ†æã€ç†è§£è‡ªç„¶è¯­è¨€æŒ‡ä»¤ |
| **å¾®ä¿¡é€šä¿¡** | ä¼ä¸šå¾®ä¿¡ API | å‘é€šçŸ¥ + æ¥æ”¶æŒ‡ä»¤ |
| **Web æœåŠ¡** | æ ‡å‡†åº“æˆ– Gin | æ¥æ”¶ä¼ä¸šå¾®ä¿¡å›è°ƒ |
| **å­˜å‚¨** | SQLite | é…ç½®ã€å‘Šè­¦è®°å½• |

## ç›‘æ§æ¨¡å—

### ç›‘æ§é¡¹ç›®

| æ£€æŸ¥é¡¹ | æ–¹æ³• | å‘Šè­¦æ¡ä»¶ | ä¼˜å…ˆçº§ |
|--------|------|---------|--------|
| å®¹å™¨çŠ¶æ€ | Docker API | å®¹å™¨æœªè¿è¡Œ | ğŸ”´ é«˜ |
| HTTP å¯è¾¾ | GET è¯·æ±‚ | çŠ¶æ€ç é 2xx æˆ–è¶…æ—¶ | ğŸ”´ é«˜ |
| PostgreSQL | `SELECT 1` | è¿æ¥å¤±è´¥æˆ–è¶…æ—¶ | ğŸ”´ é«˜ |
| Redis | `PING` | è¿æ¥å¤±è´¥æˆ–è¶…æ—¶ | ğŸ”´ é«˜ |
| ç£ç›˜ç©ºé—´ | gopsutil | ä½¿ç”¨ç‡ > 80% | ğŸŸ¡ ä¸­ |
| å†…å­˜ä½¿ç”¨ | gopsutil | ä½¿ç”¨ç‡ > 90% | ğŸŸ¡ ä¸­ |

### æ£€æŸ¥æµç¨‹

```
æ¯ 15 åˆ†é’Ÿè§¦å‘
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ£€æŸ¥æ‰€æœ‰ç›‘æ§é¡¹  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚
  æ­£å¸¸      å¼‚å¸¸
    â”‚         â”‚
    â–¼         â–¼
  è®°å½•æ—¥å¿—   ç”Ÿæˆå‘Šè­¦
              â”‚
              â–¼
         å‘é€é€šçŸ¥
              â”‚
              â–¼
         è®°å½•å‘Šè­¦çŠ¶æ€
         (é¿å…é‡å¤å‘Šè­¦)
```

### å‘Šè­¦å»é‡

```go
type AlertState struct {
    ContainerDown  map[string]time.Time
    HTTPFailed     map[string]time.Time
    DiskHigh       bool
    MemoryHigh     bool
}

func (m *Monitor) shouldAlert(item string, isError bool) bool {
    wasError := m.state.Has(item)
    if isError && !wasError {
        return true  // æ–°é—®é¢˜ï¼Œéœ€è¦å‘Šè­¦
    }
    if !isError && wasError {
        m.notifyRecovered(item)  // æ¢å¤é€šçŸ¥
    }
    return false
}
```

### é…ç½®ç¤ºä¾‹

```yaml
monitor:
  interval: 15m

  containers:
    - name: shortlink
      id: shortlink-app-1

  http_checks:
    - name: çŸ­é“¾æ¥æœåŠ¡
      url: https://your-domain.com/health
      timeout: 10s

  databases:
    postgres:
      dsn: postgres://user:pass@localhost:5432/dbname
      timeout: 5s
    redis:
      addr: localhost:6379
      timeout: 5s

  thresholds:
    disk_percent: 80
    memory_percent: 90
```

## AI åˆ†æä¸æŒ‡ä»¤å±‚

### æ ¸å¿ƒç†å¿µ

ä¸åªæ˜¯"ç›‘æ§ + å‘Šè­¦"ï¼Œè€Œæ˜¯ä¸€ä¸ªèƒ½**ç†è§£ã€åˆ†æã€è¡ŒåŠ¨**çš„ AI è¿ç»´åŠ©æ‰‹ã€‚

```
ä¼ ç»Ÿç›‘æ§ï¼šå‘ç°é—®é¢˜ â†’ å‘Šè¯‰ä½  â†’ ä½ è‡ªå·±å¤„ç†
AI åŠ©æ‰‹ï¼šå‘ç°é—®é¢˜ â†’ åˆ†æåŸå›  â†’ å»ºè®®æ–¹æ¡ˆ â†’ å¸®ä½ æ‰§è¡Œ
```

### AI èƒ½åŠ›åˆ†å±‚

| å±‚çº§ | èƒ½åŠ› | ç¤ºä¾‹ |
|------|------|------|
| **æ„ŸçŸ¥** | æ”¶é›†ç›‘æ§æ•°æ®ã€æ—¥å¿— | å®šæ—¶æ£€æŸ¥ã€æ—¥å¿—è¯»å– |
| **ç†è§£** | åˆ†æé—®é¢˜ã€å…³è”å¤šä¿¡å· | "å†…å­˜é«˜æ˜¯å› ä¸ºæ—¥å¿—æ–‡ä»¶å¤ªå¤§" |
| **å»ºè®®** | ç»™å‡ºä¿®å¤æ–¹æ¡ˆ | "å»ºè®®æ¸…ç†æ—¥å¿—å¹¶é‡å¯æœåŠ¡" |
| **è¡ŒåŠ¨** | æ‰§è¡Œå¤æ‚æ“ä½œ | è‡ªåŠ¨æ‰§è¡Œæ¸…ç† + é‡å¯ + éªŒè¯ |

### å¯æ‰§è¡Œçš„æŒ‡ä»¤ç±»å‹

| ç±»å‹ | ç®€å•æŒ‡ä»¤ | å¤æ‚æŒ‡ä»¤ |
|------|---------|---------|
| **å®¹å™¨æ“ä½œ** | é‡å¯å®¹å™¨ | é‡å¯ â†’ ç­‰å¾… â†’ éªŒè¯ â†’ æŠ¥å‘Š |
| **æ—¥å¿—æ“ä½œ** | æŸ¥çœ‹æ—¥å¿— | åˆ†æé”™è¯¯ â†’ å®šä½åŸå›  â†’ å»ºè®®ä¿®å¤ |
| **æ¸…ç†æ“ä½œ** | æŸ¥çœ‹ç£ç›˜ | æ¸…ç†æ—¥å¿— + é•œåƒ + ä¸´æ—¶æ–‡ä»¶ â†’ æŠ¥å‘Š |
| **è¯Šæ–­æ“ä½œ** | æŸ¥çœ‹å†…å­˜ | å…¨é¢è¯Šæ–­ â†’ ç»¼åˆæŠ¥å‘Š |
| **æ•°æ®åº“æ“ä½œ** | æ£€æŸ¥è¿æ¥ | æŸ¥æ…¢æŸ¥è¯¢ + è¿æ¥æ±  â†’ ä¼˜åŒ–å»ºè®® |

### å¤æ‚æŒ‡ä»¤ç¤ºä¾‹

**ç”¨æˆ·**ï¼š"æœåŠ¡å¥½åƒå˜æ…¢äº†ï¼Œå¸®æˆ‘æŸ¥ä¸€ä¸‹"

**AI æ‰§è¡Œ**ï¼š
1. æ£€æŸ¥ HTTP å“åº”æ—¶é—´ â†’ ç¡®å®å˜æ…¢
2. æ£€æŸ¥å®¹å™¨èµ„æº â†’ å†…å­˜åé«˜
3. æ£€æŸ¥ PostgreSQL â†’ å‘ç°æ…¢æŸ¥è¯¢
4. æŸ¥çœ‹åº”ç”¨æ—¥å¿— â†’ æ•°æ®åº“è¿æ¥ç­‰å¾…
5. ç»¼åˆåˆ†æ â†’ ç”ŸæˆæŠ¥å‘Š

**AI å›å¤**ï¼š
```
è¯Šæ–­å®Œæˆï¼Œå‘ç°ä»¥ä¸‹é—®é¢˜ï¼š

1. æ•°æ®åº“æœ‰ 3 ä¸ªæ…¢æŸ¥è¯¢ï¼ˆ>1sï¼‰
2. åº”ç”¨æ—¥å¿—æ˜¾ç¤ºæ•°æ®åº“è¿æ¥ç­‰å¾…

å»ºè®®ï¼š
- ä¸º links è¡¨æ·»åŠ ç´¢å¼•
- æˆ–å…ˆé‡å¯æœåŠ¡ä¸´æ—¶ç¼“è§£

éœ€è¦æˆ‘å¸®ä½ é‡å¯æœåŠ¡å—ï¼Ÿ
```

### æŒ‡ä»¤æ‰§è¡Œæ¡†æ¶

```go
type Command struct {
    Name        string
    Description string
    Steps       []Step
    Rollback    []Step
}

type Step struct {
    Action   string
    Params   map[string]any
    Check    func() bool
    OnFail   string  // stop / continue / rollback
}

var SafeRestart = Command{
    Name: "safe_restart",
    Steps: []Step{
        {Action: "check_health", Params: {"target": "container"}},
        {Action: "stop_container", Check: containerStopped},
        {Action: "start_container", Check: containerRunning},
        {Action: "wait", Params: {"seconds": 10}},
        {Action: "check_http", Check: httpHealthy},
        {Action: "notify", Params: {"msg": "é‡å¯å®Œæˆï¼ŒæœåŠ¡æ­£å¸¸"}},
    },
}
```

### è‡ªç„¶è¯­è¨€è§£æ

```go
func (ai *AICommander) ParseIntent(userMessage string) (*Command, error) {
    prompt := `
    ç”¨æˆ·è¯´ï¼š{message}

    å¯ç”¨æŒ‡ä»¤ï¼š
    - status: æŸ¥çœ‹çŠ¶æ€
    - restart <container>: é‡å¯å®¹å™¨
    - logs <container>: æŸ¥çœ‹æ—¥å¿—
    - analyze: åˆ†ææ—¥å¿—æ‰¾é—®é¢˜
    - diagnose: å…¨é¢è¯Šæ–­
    - cleanup: æ¸…ç†ç£ç›˜ç©ºé—´
    - db_check: æ£€æŸ¥æ•°æ®åº“

    è¿”å› JSONï¼š{"command": "...", "args": {...}, "confirm_needed": bool}
    `
}
```

## å¾®ä¿¡é€šä¿¡æ¨¡å—

### åŒå‘é€šä¿¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¼ä¸šå¾®ä¿¡                                â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  å‘é€æ¶ˆæ¯    â”‚                      â”‚  æ¥æ”¶å›è°ƒ    â”‚      â”‚
â”‚  â”‚  (Webhook)  â”‚                      â”‚  (HTTP)     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                    â”‚
          â”‚ ä¸»åŠ¨æ¨é€                            â”‚ ç”¨æˆ·æŒ‡ä»¤
          â”‚                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ServerOwl                              â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚    Notifier     â”‚              â”‚   Commander      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‘Šè­¦æ¶ˆæ¯æ¨¡æ¿

```
ğŸ”´ æœåŠ¡å¼‚å¸¸å‘Šè­¦

æ—¶é—´ï¼š2025-01-20 15:30:00
æœåŠ¡å™¨ï¼šé¦™æ¸¯-1
é—®é¢˜ï¼šçŸ­é“¾æ¥æœåŠ¡ HTTP æ£€æŸ¥å¤±è´¥

è¯¦æƒ…ï¼š
- çŠ¶æ€ç ï¼š502
- å“åº”æ—¶é—´ï¼šè¶…æ—¶ï¼ˆ>10sï¼‰

AI åˆæ­¥åˆ†æï¼š
å®¹å™¨ä»åœ¨è¿è¡Œï¼Œå¯èƒ½æ˜¯åº”ç”¨å†…éƒ¨é”™è¯¯ã€‚
å»ºè®®æŸ¥çœ‹æ—¥å¿—æˆ–é‡å¯æœåŠ¡ã€‚

å›å¤æŒ‡ä»¤ï¼š
- "æ—¥å¿— shortlink" æŸ¥çœ‹æ—¥å¿—
- "é‡å¯ shortlink" é‡å¯æœåŠ¡
- "è¯Šæ–­" å…¨é¢æ£€æŸ¥
```

### æ¥æ”¶æŒ‡ä»¤å¤„ç†

```go
func (s *Server) HandleWeChatCallback(w http.ResponseWriter, r *http.Request) {
    if !s.verifySignature(r) {
        http.Error(w, "invalid signature", 403)
        return
    }

    msg, _ := s.decryptMessage(r)
    go s.processCommand(msg.FromUser, msg.Content)
    w.Write([]byte("success"))
}

func (s *Server) processCommand(userID, content string) {
    s.notifier.SendText(userID, "æ”¶åˆ°ï¼Œæ­£åœ¨å¤„ç†...")
    cmd, args := s.ai.ParseIntent(content)
    result := s.executor.Run(cmd, args)
    s.notifier.SendText(userID, result)
}
```

## æ•°æ®æµä¸å­˜å‚¨

### å­˜å‚¨è®¾è®¡ï¼ˆSQLiteï¼‰

```sql
-- å‘Šè­¦è®°å½•
CREATE TABLE alerts (
    id INTEGER PRIMARY KEY,
    type TEXT NOT NULL,
    target TEXT NOT NULL,
    status TEXT NOT NULL,
    message TEXT,
    ai_analysis TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    resolved_at DATETIME
);

-- æ“ä½œæ—¥å¿—
CREATE TABLE operations (
    id INTEGER PRIMARY KEY,
    user_id TEXT NOT NULL,
    command TEXT NOT NULL,
    parsed_action TEXT,
    steps_executed TEXT,
    result TEXT,
    success BOOLEAN,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- ç›‘æ§å¿«ç…§
CREATE TABLE metrics_history (
    id INTEGER PRIMARY KEY,
    metric_type TEXT NOT NULL,
    value REAL NOT NULL,
    recorded_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- å¯¹è¯ä¸Šä¸‹æ–‡
CREATE TABLE conversations (
    user_id TEXT PRIMARY KEY,
    last_command TEXT,
    last_result TEXT,
    context_json TEXT,
    updated_at DATETIME
);
```

### ç›®å½•ç»“æ„

```
serverowl/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ serverowl/
â”‚       â””â”€â”€ main.go
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ config.go
â”‚   â”œâ”€â”€ monitor/
â”‚   â”‚   â”œâ”€â”€ monitor.go
â”‚   â”‚   â”œâ”€â”€ container.go
â”‚   â”‚   â”œâ”€â”€ http.go
â”‚   â”‚   â”œâ”€â”€ system.go
â”‚   â”‚   â””â”€â”€ database.go
â”‚   â”œâ”€â”€ notifier/
â”‚   â”‚   â””â”€â”€ wechat.go
â”‚   â”œâ”€â”€ commander/
â”‚   â”‚   â”œâ”€â”€ commander.go
â”‚   â”‚   â”œâ”€â”€ parser.go
â”‚   â”‚   â”œâ”€â”€ executor.go
â”‚   â”‚   â””â”€â”€ commands/
â”‚   â”‚       â”œâ”€â”€ restart.go
â”‚   â”‚       â”œâ”€â”€ logs.go
â”‚   â”‚       â”œâ”€â”€ diagnose.go
â”‚   â”‚       â””â”€â”€ cleanup.go
â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â”œâ”€â”€ client.go
â”‚   â”‚   â”œâ”€â”€ analyzer.go
â”‚   â”‚   â””â”€â”€ prompts.go
â”‚   â”œâ”€â”€ storage/
â”‚   â”‚   â””â”€â”€ sqlite.go
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ http.go
â”œâ”€â”€ configs/
â”‚   â””â”€â”€ config.yaml
â””â”€â”€ go.mod
```

## å®‰å…¨ä¸é”™è¯¯å¤„ç†

### å®‰å…¨æœºåˆ¶

1. **ç”¨æˆ·ç™½åå•**ï¼šåªå…è®¸æŒ‡å®šç”¨æˆ·æ“ä½œ
2. **å‘½ä»¤ç™½åå•**ï¼šä¸å…è®¸ä»»æ„ shellï¼Œåªèƒ½æ‰§è¡Œé¢„å®šä¹‰æ“ä½œ
3. **äºŒæ¬¡ç¡®è®¤**ï¼šå±é™©æ“ä½œéœ€è¦ç¡®è®¤
4. **æ“ä½œå®¡è®¡**ï¼šæ‰€æœ‰æ“ä½œéƒ½è®°å½•

### äºŒæ¬¡ç¡®è®¤ç¤ºä¾‹

```
ç”¨æˆ·ï¼šæ¸…ç†ç£ç›˜
AIï¼šæ£€æµ‹åˆ°ä»¥ä¸‹å¯æ¸…ç†å†…å®¹ï¼š
    - Docker æœªä½¿ç”¨é•œåƒï¼š2.3GB
    - 7å¤©å‰çš„æ—¥å¿—ï¼š500MB

    ç¡®è®¤æ¸…ç†å—ï¼Ÿå›å¤"ç¡®è®¤æ¸…ç†"æ‰§è¡Œ
```

### é”™è¯¯å¤„ç†

- ç›‘æ§å¤±è´¥ï¼šè¿ç»­ 3 æ¬¡å¤±è´¥æ‰å‘Šè­¦
- LLM è°ƒç”¨å¤±è´¥ï¼šé™çº§è¿”å›åŸå§‹ä¿¡æ¯
- å¾®ä¿¡å‘é€å¤±è´¥ï¼šé‡è¯• + æœ¬åœ°æš‚å­˜
- å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼šå›æ»š + é€šçŸ¥

## éƒ¨ç½²

### éƒ¨ç½²ä½ç½®

**ç°é˜¶æ®µ**ï¼šéƒ¨ç½²åœ¨é¦™æ¸¯æœåŠ¡å™¨ä¸Š + å¤–éƒ¨å…œåº•ï¼ˆUptimeRobotï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           é¦™æ¸¯æœåŠ¡å™¨              â”‚
â”‚   ServerOwl + çŸ­é“¾æ¥æœåŠ¡          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¤–éƒ¨å…œåº•ï¼ˆUptimeRobot å…è´¹ç‰ˆï¼‰   â”‚
â”‚   æœåŠ¡å™¨å®Œå…¨æŒ‚äº†æ—¶é€šçŸ¥            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æœªæ¥å¤šæœåŠ¡å™¨**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Controller     â”‚  â† AI åˆ†æ + é€šçŸ¥
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼         â–¼         â–¼
  Agent     Agent     Agent
  (é¦™æ¸¯)    (å¤§é™†1)   (å¤§é™†2)
```

### éƒ¨ç½²æ–¹å¼

```bash
# ç¼–è¯‘
go build -o serverowl ./cmd/serverowl

# è¿è¡Œ
./serverowl -config /path/to/config.yaml
```

æˆ–ä½¿ç”¨ Docker / Systemdã€‚

### å®Œæ•´é…ç½®

```yaml
server:
  port: 8080
  external_url: "https://your-domain.com/webhook"

wechat:
  corp_id: "your_corp_id"
  agent_id: "1000002"
  secret: "your_secret"
  token: "callback_token"
  encoding_aes_key: "your_aes_key"
  allowed_users:
    - "YourUserID"

llm:
  provider: "deepseek"
  api_key: "your_api_key"
  base_url: "https://api.deepseek.com"
  model: "deepseek-chat"

monitor:
  interval: 15m
  containers:
    - name: shortlink
      id: shortlink-app-1
  http_checks:
    - name: çŸ­é“¾æ¥æœåŠ¡
      url: "https://your-domain.com/health"
      timeout: 10s
  databases:
    postgres:
      dsn: "postgres://user:pass@localhost:5432/shortlink"
      timeout: 5s
    redis:
      addr: "localhost:6379"
      timeout: 5s
  thresholds:
    disk_percent: 80
    memory_percent: 90

storage:
  path: "/data/serverowl.db"

logging:
  level: "info"
  file: "/var/log/serverowl.log"
```

## é‡Œç¨‹ç¢‘è§„åˆ’

| é˜¶æ®µ | å†…å®¹ | é¢„ä¼°æ—¶é—´ |
|------|------|---------|
| **M1** | åŸºç¡€ç›‘æ§ + å¾®ä¿¡é€šçŸ¥ | 3-4 å¤© |
| **M2** | ç®€å•æŒ‡ä»¤ï¼ˆçŠ¶æ€ã€é‡å¯ã€æ—¥å¿—ï¼‰ | 2-3 å¤© |
| **M3** | AI æ—¥å¿—åˆ†æ | 2-3 å¤© |
| **M4** | å¤æ‚æŒ‡ä»¤ + è¯Šæ–­ | 3-4 å¤© |
| **M5** | å®Œå–„ + æµ‹è¯• | 2-3 å¤© |

æ¯ä¸ªé‡Œç¨‹ç¢‘éƒ½æ˜¯å¯è¿è¡Œã€å¯å±•ç¤ºçš„çŠ¶æ€ã€‚

## åç»­æ‰©å±•

| æ‰©å±• | æè¿° | å¤æ‚åº¦ |
|------|------|--------|
| å¤šæœåŠ¡å™¨ | æ”¯æŒç®¡ç†å¤šå°æœåŠ¡å™¨ | ä¸­ |
| è·¨æœåŠ¡å™¨å¤‡ä»½ | å®šæœŸå¤‡ä»½åˆ°å…¶ä»–æœåŠ¡å™¨ | ä¸­ |
| è¶‹åŠ¿åˆ†æ | ç£ç›˜/å†…å­˜ä½¿ç”¨è¶‹åŠ¿é¢„æµ‹ | ä¸­ |
| å®šæ—¶ä»»åŠ¡ | å®šæœŸæ¸…ç†ã€å¤‡ä»½ | ä½ |
| Web é¢æ¿ | å¯è§†åŒ–ç›‘æ§æ•°æ® | é«˜ |

## å­¦ä¹ æ”¶ç›Š

| æŠ€æœ¯æ–¹å‘ | å…·ä½“å†…å®¹ |
|---------|---------|
| **Go è¯­è¨€** | å¹¶å‘ã€HTTP æœåŠ¡ã€å¤–éƒ¨ API è°ƒç”¨ |
| **ç³»ç»Ÿç¼–ç¨‹** | ç³»ç»ŸæŒ‡æ ‡é‡‡é›†ã€Docker API |
| **LLM åº”ç”¨** | Prompt è®¾è®¡ã€æ„å›¾è§£æã€æ—¥å¿—åˆ†æ |
| **æ¶ˆæ¯é›†æˆ** | ä¼ä¸šå¾®ä¿¡ API å¯¹æ¥ |
| **æœåŠ¡è®¾è®¡** | æ¨¡å—åŒ–æ¶æ„ã€å¯æ‰©å±•è®¾è®¡ |
